<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matt Williamosn" />

  
  
  
    
  
  <meta name="description" content="Often when we build our databases for analyses, we&rsquo;ll be working with both vector and raster data models. This creates two issues:
 It&rsquo;s not easy (or often possible) to perform calculations across data models Many statistical algorithms expect dataframes with dependent and independent variables which makes working with rasters particularly tricky." />

  
  <link rel="alternate" hreflang="en-us" href="http://isdrfall21.classes.spaseslab.com/example/06-example/" />

  









  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#0033A0" />
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous" media="print" onload="this.media='all'">

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.6de7d9d991ec63060e206f02cf589456.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hucbe598379047767cc1c1c9b182811605_98018_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hucbe598379047767cc1c1c9b182811605_98018_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="http://isdrfall21.classes.spaseslab.com/example/06-example/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@MwilliamsonMatt" />
    <meta property="twitter:creator" content="@MwilliamsonMatt" />
  
  <meta property="og:site_name" content="Spatial Data in R" />
  <meta property="og:url" content="http://isdrfall21.classes.spaseslab.com/example/06-example/" />
  <meta property="og:title" content="Combining raster and vector data | Spatial Data in R" />
  <meta property="og:description" content="Often when we build our databases for analyses, we&rsquo;ll be working with both vector and raster data models. This creates two issues:
 It&rsquo;s not easy (or often possible) to perform calculations across data models Many statistical algorithms expect dataframes with dependent and independent variables which makes working with rasters particularly tricky." /><meta property="og:image" content="http://isdrfall21.classes.spaseslab.com/media/icon_hucbe598379047767cc1c1c9b182811605_98018_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="http://isdrfall21.classes.spaseslab.com/media/icon_hucbe598379047767cc1c1c9b182811605_98018_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-10-13T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-10-13T00:00:00&#43;00:00">
  

  



  

  

  <link rel="stylesheet" type="text/css" href="/custom-css/print.css" media="print" />

  <link rel="shortcut icon" href="http://isdrfall21.classes.spaseslab.com/iSDR_logo.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo152x152.png" />
  <link rel="icon" type="image/png" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo16x16.png" sizes="16x16" />
  <meta name="application-name" content="HES 597: Spatial Data in R" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="http://isdrfall21.classes.spaseslab.com/img/mstile-144x144.png" />


  <title>Combining raster and vector data | Spatial Data in R</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper  ">

  
  
  
  
  
  <script src="/js/wowchemy-init.js"></script>

    




    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Spatial Data in R</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Spatial Data in R</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/syllabus/"><span>Syllabus</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/schedule/"><span>Schedule</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/content/"><span>Content</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/example/"><span>Examples</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/assignment/"><span>Assignments</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource/"><span>Resources</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://ecostatsbsu.slack.com/archives/CV4DEJ8M7" target="_blank" rel="noopener"><span><i class="fab fa-slack"></i></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://rstudio.boisestate.edu/" target="_blank" rel="noopener"><span><i class="fab fa-r-project"></i></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>



    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/">Code examples</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/01-example/">Examples</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/01-example/">1: Introduction to course resources, Rmarkdown, and data in R</a>
      </li>

      
      <li >
        <a href="/example/02-example/">2: Getting your spatial data into R</a>
      </li>

      
      <li >
        <a href="/example/03-example/">3: Points, lines, and polygons in R</a>
      </li>

      
      <li >
        <a href="/example/04-example/">4: Rasters in R</a>
      </li>

      
      <li >
        <a href="/example/05-example/">5: Spatial databases in R</a>
      </li>

      
      <li class="active">
        <a href="/example/06-example/">6: Combining raster and vector data</a>
      </li>

      
      <li >
        <a href="/example/07-example/">7: Static maps in R</a>
      </li>

      
      <li >
        <a href="/example/08-example/">8: Better maps in R</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>
        </div>

        
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>

            <nav id="TableOfContents">
  <ul>
    <li><a href="#load-your-libraries-and-the-data">Load your libraries and the data</a></li>
    <li><a href="#filter-the-data">Filter the data</a></li>
    <li><a href="#get-the-data-for-median-income-by-county">Get the data for median income by county</a></li>
    <li><a href="#use-a-spatial-join">Use a spatial join</a></li>
    <li><a href="#buffer-your-pas">Buffer your PAs</a></li>
    <li><a href="#crop-all-of-the-rasters-to-the-extent-of-your-buffered-pa-dataset">Crop all of the rasters to the extent of your buffered PA dataset</a></li>
    <li><a href="#extract-the-data">Extract the data</a></li>
    <li><a href="#join-back-to-your-pa-dataset">Join back to your PA dataset</a></li>
  </ul>
</nav>

            
        </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>Combining raster and vector data</h1>

                    

                    

                    

                    <div class="article-style">
                        <p>Often when we build our databases for analyses, we&rsquo;ll be working with both vector and raster data models. This creates two issues:</p>
<ol>
<li>It&rsquo;s not easy (or often possible) to perform calculations across data models</li>
<li>Many statistical algorithms expect dataframes with dependent and independent variables which makes working with rasters particularly tricky.</li>
</ol>
<p>Today we&rsquo;ll look at a few ways to bring these two data models together to develop a dataset for analysis.</p>
<h2 id="load-your-libraries-and-the-data">Load your libraries and the data</h2>
<p>Let&rsquo;s bring in the data. You should recognize the regional PA dataset and the land value dataset as we&rsquo;ve been working with them a fair amount the last few weeks. The dataset you may not recognize is the species richness dataset (here, for mammals). These data come from a series of studies led by Clinton Jenkins and available <a href="https://biodiversitymapping.org/" target="_blank" rel="noopener">here</a>. Let&rsquo;s read them in here.</p>
<pre><code class="language-r">library(tidyverse)
</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──
</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.5     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   2.0.2     ✓ forcats 0.5.1
</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre>
<pre><code class="language-r">library(pander)
library(sf)
</code></pre>
<pre><code>## Linking to GEOS 3.8.1, GDAL 3.2.1, PROJ 7.2.1
</code></pre>
<pre><code class="language-r">library(terra)
</code></pre>
<pre><code>## terra version 1.4.14
</code></pre>
<pre><code>## 
## Attaching package: 'terra'
</code></pre>
<pre><code>## The following object is masked from 'package:pander':
## 
##     wrap
</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     src
</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     extract
</code></pre>
<pre><code class="language-r">library(units)
</code></pre>
<pre><code>## udunits database from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/units/share/udunits/udunits2.xml
</code></pre>
<pre><code class="language-r">library(purrr)
library(sp)
library(profvis)
#landval &lt;- terra::rast('/Users/matthewwilliamson/Downloads/session04/idval.tif')
landval &lt;- rast('/Users/mattwilliamson/Google Drive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session16/Regval.tif')
mammal.rich &lt;- rast('/Users/mattwilliamson/Google Drive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session16/Mammals_total_richness.tif')
#mammal.rich &lt;- rast('/Users/matthewwilliamson/Downloads/session16/Mammals_total_richness.tif')
pas.desig &lt;- st_read('/Users/mattwilliamson/Google Drive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session04/regionalPAs1.shp')
</code></pre>
<pre><code>## Reading layer `regionalPAs1' from data source 
##   `/Volumes/GoogleDrive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session04/regionalPAs1.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 224 features and 7 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -1714157 ymin: 1029431 xmax: -621234.8 ymax: 3043412
## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version
</code></pre>
<pre><code class="language-r">#pas.desig &lt;- st_read('/Users/matthewwilliamson/Downloads/session04/regionalPAs1.shp')
#pas.proc &lt;- st_read('/Users/matthewwilliamson/Downloads/session16/reg_pas.shp')
pas.proc &lt;- st_read('/Users/mattwilliamson/Google Drive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session16/reg_pas.shp')
</code></pre>
<pre><code>## Reading layer `reg_pas' from data source 
##   `/Volumes/GoogleDrive/My Drive/TEACHING/Intro_Spatial_Data_R/Data/session16/reg_pas.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 544 features and 32 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -2034299 ymin: 1004785 xmax: -530474 ymax: 3059862
## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version
</code></pre>
<pre><code class="language-r">#combine the pas into 1, but the columns don't all match, thanks PADUS

colnames(pas.proc)[c(1, 6, 8, 10, 12, 22, 25)] &lt;- colnames(pas.desig) #find the columnames in the proc dataset and replace them with the almost matching names from the des.
</code></pre>
<pre><code>## Warning in colnames(pas.proc)[c(1, 6, 8, 10, 12, 22, 25)] &lt;-
## colnames(pas.desig): number of items to replace is not a multiple of replacement
## length
</code></pre>
<pre><code class="language-r">pas &lt;- pas.proc %&gt;% 
  select(., colnames(pas.desig)) %&gt;% 
  bind_rows(pas.desig, pas.proc) #select the columns that match and then combine
</code></pre>
<p>Because we haven&rsquo;t looked at the species richness data yet, let&rsquo;s plot it here.</p>
<pre><code class="language-r">plot(mammal.rich)
</code></pre>
<p><img src="/example/06-example_files/figure-html/mamplot-1.png" width="672" /></p>
<p>Ooof. Not pretty. That&rsquo;s because this data is stored as a catgorical raster displaying the count of species contained within each 10km grid cell. Often we are interested in knowing more than just how many species occur. We&rsquo;d rather know something about how many speices and how rare they are. That data is also contained here and we can get it using <code>terra::catalyze</code>.</p>
<pre><code class="language-r">mammal.rich &lt;- catalyze(mammal.rich)
plot(mammal.rich)
</code></pre>
<p><img src="/example/06-example_files/figure-html/mamcat-1.png" width="672" /></p>
<p>When we plot the data we see that the &ldquo;Value&rdquo; raster contains the informaiton we are looking for (the number of species weighted by their regional rarity). Lets take that and leave the rest.</p>
<pre><code class="language-r">mammal.rich &lt;- mammal.rich[[2]]
plot(mammal.rich)
</code></pre>
<p><img src="/example/06-example_files/figure-html/mamassign-1.png" width="672" /></p>
<p>Before we move on into our analysis phase. Let&rsquo;s double check the CRS of our data.</p>
<pre><code class="language-r">st_crs(mammal.rich)$proj4string
</code></pre>
<pre><code>## [1] &quot;+proj=aea +lat_0=37.5 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs&quot;
</code></pre>
<pre><code class="language-r">st_crs(landval)$proj4string
</code></pre>
<pre><code>## [1] &quot;+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs&quot;
</code></pre>
<pre><code class="language-r">st_crs(pas)$proj4string
</code></pre>
<pre><code>## [1] &quot;+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs&quot;
</code></pre>
<p>Alhtough the PAs and land value rasters match, the mammal richness is in a different project. We&rsquo;ll deal with that once we&rsquo;ve subsetted the data a bit.</p>
<h2 id="filter-the-data">Filter the data</h2>
<p>You&rsquo;ll need to filter the PADUS dataset so that it only contains the <a href="https://www.usgs.gov/core-science-systems/science-analytics-and-synthesis/gap/science/pad-us-data-overview?qt-science_center_objects=0#qt-science_center_objects" target="_blank" rel="noopener">Gap Status 1</a> protected areas. Here, I&rsquo;ll do it for Idaho. Note that the PADUS breaks PAs out by how they were created so we need to combine both the designated and proclaimed areas in the data load coad.</p>
<pre><code class="language-r">id.gap.1 &lt;- pas %&gt;% 
  filter(., State_Nm == &quot;ID&quot; &amp; GAP_Sts == &quot;1&quot;)
</code></pre>
<h2 id="get-the-data-for-median-income-by-county">Get the data for median income by county</h2>
<p>Now let&rsquo;s get the median income data and geometry for each county. We&rsquo;ll use the tidycensus package for that. Note that you may have to sign up for a Census Api before you can use the tidycensus package (<a href="https://walker-data.com/tidycensus/articles/basic-usage.html" target="_blank" rel="noopener">instructions here</a>)</p>
<pre><code class="language-r">id.income &lt;- tidycensus:: get_acs(geography = &quot;county&quot;, 
              variables = c(medianicome = &quot;B19013_001&quot;),
              state = &quot;ID&quot;, 
              year = 2018,
              key = key,
              geometry = TRUE) %&gt;% 
                st_transform(., st_crs(pas))
</code></pre>
<pre><code>## Getting data from the 2014-2018 5-year ACS
</code></pre>
<pre><code>## Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.
</code></pre>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |==                                                                    |   4%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |================                                                      |  24%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================| 100%
</code></pre>
<h2 id="use-a-spatial-join">Use a spatial join</h2>
<p>Use <code>st_join</code> to connect your PAs dataset with every county within 50km and then use <code>group_by</code> and <code>summarise</code> to take the mean value of the median income data for each PA. By the time you are done with this step you should have the same number of rows that you had after your initial filter of the PAs (step 2).</p>
<pre><code class="language-r">pa.income &lt;- st_join(id.gap.1, id.income, join = st_is_within_distance, dist=50000)

pa.income.summary &lt;- pa.income %&gt;% 
  group_by(Unit_Nm) %&gt;% 
  summarize(., meaninc = mean(estimate))
</code></pre>
<h2 id="buffer-your-pas">Buffer your PAs</h2>
<p>In order to get the raster data from the same area that you just estimated median income, you&rsquo;ll need to buffer the PAs by 50km</p>
<pre><code class="language-r">pa.buf &lt;- id.gap.1 %&gt;% 
  st_buffer(., 50000)
</code></pre>
<h2 id="crop-all-of-the-rasters-to-the-extent-of-your-buffered-pa-dataset">Crop all of the rasters to the extent of your buffered PA dataset</h2>
<p>Before you start doing a bunch of raster processing you&rsquo;ll want to get rid of the parts you don&rsquo;t need. Do that here. Remember you&rsquo;ll want all of your rasters to have the same CRS. We won&rsquo;t do that here (but you probably know how to do it)</p>
<pre><code class="language-r">pa.buf.vect &lt;- as(pa.buf, &quot;SpatVector&quot;)

mam.rich.crop &lt;- crop(mammal.rich, project(pa.buf.vect, mammal.rich))
id.val.crop &lt;- crop(landval, project(pa.buf.vect, landval))
</code></pre>
<h2 id="extract-the-data">Extract the data</h2>
<p>Now that you&rsquo;ve got all the data together, it&rsquo;s time to run the extraction. Remember that extractions run faster when all of the layers are &ldquo;stacked&rdquo;, but that requires you to use <code>resample</code> to get to the same origins and extents. Use <code>zonal</code> to estimate the <code>mean</code> and <code>sd</code> for each of the mammalian richness, land value, and NDVI datasets. Then use <code>extract</code> (without specifying a function) to estimate the same thig. Use <code>system.time()</code> to bencmark each approach. I&rsquo;ll demonstrate for the richness data using zonal stats.</p>
<pre><code class="language-r">pa.buf.vect.proj &lt;- terra::project(pa.buf.vect, mammal.rich)
pa.buf.zones &lt;- terra::rasterize(pa.buf.vect.proj, mam.rich.crop, field = &quot;Unit_Nm&quot;)
mammal.zones &lt;- terra::zonal(mam.rich.crop, pa.buf.zones, fun = &quot;mean&quot;, na.rm=TRUE)
zonal.time &lt;- system.time(terra::zonal(mam.rich.crop, pa.buf.zones, fun = &quot;mean&quot;, na.rm=TRUE))
</code></pre>
<h2 id="join-back-to-your-pa-dataset">Join back to your PA dataset</h2>
<p>Now that you have the raster data extracted and summarized (into the mean and standard deviation) for each buffered PA, you should be able to join it back to the dataset you created in steps 2-4. I&rsquo;ll do that here</p>
<pre><code class="language-r">summary.df &lt;- pa.income.summary %&gt;% 
  left_join(., mammal.zones)
</code></pre>
<pre><code>## Joining, by = &quot;Unit_Nm&quot;
</code></pre>
<pre><code class="language-r">head(summary.df)
</code></pre>
<pre><code>## Simple feature collection with 6 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -1637570 ymin: 2277825 xmax: -1396163 ymax: 2675919
## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version
## # A tibble: 6 × 4
##   Unit_Nm              meaninc                                    geometry Value
##   &lt;chr&gt;                  &lt;dbl&gt;                          &lt;MULTIPOLYGON [m]&gt; &lt;dbl&gt;
## 1 Big Jacks Creek Wil…  50094  (((-1615346 2364480, -1615519 2363694, -16…  NA  
## 2 Bruneau-Jarbidge Ri…  50265  (((-1593547 2361288, -1593505 2361239, -15…  77.5
## 3 Cecil D. Andrus-Whi…  46314. (((-1483396 2496861, -1483426 2496828, -14…  NA  
## 4 Cecil D. Andrus-Whi…  46314. (((-1485076 2510359, -1484999 2510359, -14…  NA  
## 5 Craters of the Moon…  47762. (((-1398389 2402114, -1398445 2401816, -13…  79.9
## 6 Frank Church-River …  45915  (((-1485925 2548854, -1485887 2548829, -14…  80.3
</code></pre>

                    </div>

                    



                    
                    <div class="article-widget">
                        
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/example/07-example/" rel="next">Static maps in R</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/example/05-example/" rel="prev">Building spatial databases</a>
  </div>
  
</div>

                    </div>
                    
                </div>

                <div class="body-footer">
                    <p>Last updated on Oct 13, 2021</p>

                    





                    



                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>HES 597: Spatial Data in R (Fall 2021)</strong><br>

                <a href="https://www.boisestate.edu" target="_blank" rel="noopener">Boise State University</a> &emsp;&emsp;
                <a href="https://www.boisestate.edu/hes/" target="_blank" rel="noopener">Human-Environment Systems</a>
            </p>

            <p>
                <a href="https://www.boisestate.edu/hes/people/matt-williamson/" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Dr. Matt Williamson</a> &emsp;&emsp;
                <a href="mailto:mattwilliamson@boisestate.edu"><i class="fas fa-envelope"></i>
                    mattwilliamson@boisestate.edu</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> T TH &emsp;&emsp;
                <i class="far fa-clock"></i> 10:30 - 11:45 
                <br><i class="fas fa-university"></i> Albertson&#39;s Library Rm201C
            </p>
        </div>

        <div class="col-md-5 credits">
            <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2021 <a href="https://www.boisestate.edu/hes/people/matt-williamson/" target="_blank" rel="noopener">Matt Williamson</a></p>
        
            <p>This site was inspired by Andrew Heiss' <a href="https://datavizs21.classes.andrewheiss.com/" target="_blank" rel="noopener">Data Visualization course</a> created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/mattwilliamson13/isdrfall21" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>

        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.99ddacf76b31e04b589f8ff7e550cbb8.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>