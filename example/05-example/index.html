<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matt Williamosn" />

  
  
  
    
  
  <meta name="description" content="One of the strongest justifications for using R as a Geographic Information System (GIS) is the ability to construct complete, reproducible workflows from data entry and cleaning through analysis and visualization." />

  
  <link rel="alternate" hreflang="en-us" href="http://isdrfall21.classes.spaseslab.com/example/05-example/" />

  









  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#0033A0" />
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous" media="print" onload="this.media='all'">

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.6de7d9d991ec63060e206f02cf589456.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hucbe598379047767cc1c1c9b182811605_98018_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hucbe598379047767cc1c1c9b182811605_98018_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="http://isdrfall21.classes.spaseslab.com/example/05-example/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@MwilliamsonMatt" />
    <meta property="twitter:creator" content="@MwilliamsonMatt" />
  
  <meta property="og:site_name" content="Spatial Data in R" />
  <meta property="og:url" content="http://isdrfall21.classes.spaseslab.com/example/05-example/" />
  <meta property="og:title" content="Building spatial databases | Spatial Data in R" />
  <meta property="og:description" content="One of the strongest justifications for using R as a Geographic Information System (GIS) is the ability to construct complete, reproducible workflows from data entry and cleaning through analysis and visualization." /><meta property="og:image" content="http://isdrfall21.classes.spaseslab.com/media/icon_hucbe598379047767cc1c1c9b182811605_98018_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="http://isdrfall21.classes.spaseslab.com/media/icon_hucbe598379047767cc1c1c9b182811605_98018_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-10-06T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-10-06T00:00:00&#43;00:00">
  

  



  

  

  <link rel="stylesheet" type="text/css" href="/custom-css/print.css" media="print" />

  <link rel="shortcut icon" href="http://isdrfall21.classes.spaseslab.com/iSDR_logo.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo152x152.png" />
  <link rel="icon" type="image/png" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="http://isdrfall21.classes.spaseslab.com/img/iSDR_logo16x16.png" sizes="16x16" />
  <meta name="application-name" content="HES 597: Spatial Data in R" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="http://isdrfall21.classes.spaseslab.com/img/mstile-144x144.png" />


  <title>Building spatial databases | Spatial Data in R</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper  ">

  
  
  
  
  
  <script src="/js/wowchemy-init.js"></script>

    




    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Spatial Data in R</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Spatial Data in R</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/syllabus/"><span>Syllabus</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/schedule/"><span>Schedule</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/content/"><span>Content</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/example/"><span>Examples</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/assignment/"><span>Assignments</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/resource/"><span>Resources</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://ecostatsbsu.slack.com/archives/CV4DEJ8M7" target="_blank" rel="noopener"><span><i class="fab fa-slack"></i></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://rstudio.boisestate.edu/" target="_blank" rel="noopener"><span><i class="fab fa-r-project"></i></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>



    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
    
  

  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/">Code examples</a>
      </li>

      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/example/01-example/">Examples</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/example/01-example/">1: Introduction to course resources, Rmarkdown, and data in R</a>
      </li>

      
      <li >
        <a href="/example/02-example/">2: Getting your spatial data into R</a>
      </li>

      
      <li >
        <a href="/example/03-example/">3: Points, lines, and polygons in R</a>
      </li>

      
      <li >
        <a href="/example/04-example/">4: Rasters in R</a>
      </li>

      
      <li class="active">
        <a href="/example/05-example/">5: Spatial databases in R</a>
      </li>

      
      <li >
        <a href="/example/06-example/">6: Combining raster and vector data</a>
      </li>

      
      <li >
        <a href="/example/07-example/">7: Static maps in R</a>
      </li>

      
      <li >
        <a href="/example/08-example/">8: Better maps in R</a>
      </li>

      
      <li >
        <a href="/example/09-example/">9: Scale and autocorrelation</a>
      </li>

      
    </ul>
    

  </div>
  
  
</nav>
        </div>

        
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>

            <nav id="TableOfContents"></nav>

            
        </div>
        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>Building spatial databases</h1>

                    

                    

                    

                    <div class="article-style">
                        <p>One of the strongest justifications for using <code>R</code> as a Geographic Information System (GIS) is the ability to construct complete, reproducible workflows from data entry and cleaning through analysis and visualization. Constructing databases that combine spatial and tabular data is at the core of those workflows. This example should help you practice some of the key database operations that you may encounter as you conduct your own analysis.</p>
<h1 id="load-the-datasets-and-packages">Load the datasets and packages</h1>
<p>The data we&rsquo;ll be using for today&rsquo;s example and assignment are a mix of spatial and tabular data. The tabular data come from the <a href="https://www.landgrabu.org/" target="_blank" rel="noopener">Land-Grab University(LGU)</a> data on parcel sales and the National Park Service&rsquo;s (NPS) <a href="https://irma.nps.gov/STATS/Reports/National" target="_blank" rel="noopener">annual visitation data</a> for NPS-operated units in the Intermountain and Pacific West regions. The spatial data is a shapefile from the US Protected Area Database (PADUS) and a shapefile containing the parcels described by the Land-Grab University parcel database. We&rsquo;ll load each of those here and take a look at features and fields in each dataset. <strong>Remember that you&rsquo;ll need to change the paths to match your own data.</strong></p>
<pre><code class="language-r">library(sf)
</code></pre>
<pre><code>## Linking to GEOS 3.8.1, GDAL 3.2.1, PROJ 7.2.1
</code></pre>
<pre><code class="language-r">library(tidyverse)
</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──
</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.3     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   2.0.0     ✓ forcats 0.5.1
</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre>
<pre><code class="language-r">nps.visits.csv &lt;- read_csv('/Users/matthewwilliamson/Downloads/session14/ParkVisits_2020IWPW.csv', skip = 3)
</code></pre>
<pre><code>## Rows: 1668 Columns: 8
</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): ParkName, UnitCode, ParkType, Region, State
## dbl (2): Year, Month
</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">head(nps.visits.csv)
</code></pre>
<pre><code>## # A tibble: 6 × 8
##   ParkName       UnitCode ParkType   Region   State  Year Month RecreationVisits
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;
## 1 Alibates Flin… ALFL     National … Intermo… TX     2020     1              273
## 2 Alibates Flin… ALFL     National … Intermo… TX     2020     2              314
## 3 Alibates Flin… ALFL     National … Intermo… TX     2020     3              233
## 4 Alibates Flin… ALFL     National … Intermo… TX     2020     4                0
## 5 Alibates Flin… ALFL     National … Intermo… TX     2020     5                0
## 6 Alibates Flin… ALFL     National … Intermo… TX     2020     6              130
</code></pre>
<pre><code class="language-r">parcels.csv &lt;- read_csv('/Users/matthewwilliamson/Downloads/session14/Parcels.csv')
</code></pre>
<pre><code>## Rows: 79461 Columns: 43
</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (36): MTRSA_LG, Loc_State, Loc_County, LG_State, LG_Reason, University, ...
## dbl  (6): Acres, Yr_ST_Accept, Yr_Uni_Assign, Yr_Patent, Date_Patent, GIS_Ac...
</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">head(parcels.csv)
</code></pre>
<pre><code>## # A tibble: 6 × 43
##   MTRSA_LG      Loc_State Loc_County Acres LG_State LG_Reason        University 
##   &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;      
## 1 &quot;AR050020S02… AR        Garland      160 AL       Patented under … Auburn Uni…
## 2 &quot;KS060210S00… KS        McPherson     40 AL       Patented under … Auburn Uni…
## 3 &quot;KS060210S00… KS        McPherson     40 AL       Patented under … Auburn Uni…
## 4 &quot;KS060190S01… KS        Barton        80 AL       Patented under … Auburn Uni…
## 5 &quot;KS060190S01… KS        Barton        80 AL       Patented under … Auburn Uni…
## 6 &quot;KS060210S00… KS        McPherson     80 AL       Patented under … Auburn Uni…
## # … with 36 more variables: Uni_Ben_History &lt;chr&gt;, Royce_ID &lt;chr&gt;,
## #   Tribal_Nation &lt;chr&gt;, US_Acquired_Mode &lt;chr&gt;, Cession_States &lt;chr&gt;,
## #   Royce_Link &lt;chr&gt;, Yr_US_Acquire &lt;chr&gt;, Date_US_Acquire &lt;chr&gt;,
## #   US_Paid_for_Parcel &lt;chr&gt;, Endow_Raised_Parcel &lt;chr&gt;,
## #   Uni_Raise_US_Pay_Multiple &lt;chr&gt;, Yr_ST_Accept &lt;dbl&gt;, Yr_Uni_Assign &lt;dbl&gt;,
## #   Yr_Patent &lt;dbl&gt;, Date_Patent &lt;dbl&gt;, Patentees &lt;chr&gt;,
## #   Patent_Source_Reason &lt;chr&gt;, Source_ID &lt;chr&gt;, Source &lt;chr&gt;,
## #   Source_Loc &lt;chr&gt;, Source_Type &lt;chr&gt;, Source_Form &lt;chr&gt;, Source_Acqu &lt;chr&gt;,
## #   Source_Acqu_Detail &lt;chr&gt;, Located_GIS &lt;chr&gt;, Parcel_Link &lt;chr&gt;,
## #   MTRSA &lt;chr&gt;, MTRS &lt;chr&gt;, A_or_L &lt;chr&gt;, Aliquot &lt;chr&gt;, Types &lt;chr&gt;,
## #   GISAcres &lt;dbl&gt;, GIS_Acre_Div_List_Acre &lt;dbl&gt;, Polygon &lt;chr&gt;,
## #   Accuracy &lt;chr&gt;, LG_Royce &lt;chr&gt;
</code></pre>
<pre><code class="language-r">regional.pas.sf &lt;- read_sf('/Users/matthewwilliamson/Downloads/session14/reg_pas.shp')

regional.pas.sf
</code></pre>
<pre><code>## Simple feature collection with 544 features and 32 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -2034299 ymin: 1004785 xmax: -530474 ymax: 3059862
## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version
## # A tibble: 544 × 33
##    Categry Own_Typ Own_Nam Loc_Own Mng_Typ Mang_Nm Loc_Mng Des_Tp Loc_Ds Unit_Nm
##    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  
##  1 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   AS     Nation…
##  2 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   CA     San Lu…
##  3 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   CA     San Lu…
##  4 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   COORD  C. J. …
##  5 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   COORD  Carey …
##  6 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   COORD  Hagerm…
##  7 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   COORD  North …
##  8 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   COORD  Sand C…
##  9 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   FR     Eagle …
## 10 Procla… DESG    DESG    &lt;NA&gt;    FED     FWS     0       PROC   FSA    Farm S…
## # … with 534 more rows, and 23 more variables: Loc_Nm &lt;chr&gt;, Stat_Nm &lt;chr&gt;,
## #   Agg_Src &lt;chr&gt;, GIS_Src &lt;chr&gt;, Src_Dat &lt;chr&gt;, GIS_Acr &lt;int&gt;, Sr_PAID &lt;chr&gt;,
## #   WDPA_Cd &lt;int&gt;, Pb_Accs &lt;chr&gt;, Accss_S &lt;chr&gt;, Accss_D &lt;chr&gt;, GAP_Sts &lt;chr&gt;,
## #   GAPCdSr &lt;chr&gt;, GAPCdDt &lt;chr&gt;, IUCN_Ct &lt;chr&gt;, IUCNCtS &lt;chr&gt;, IUCNCtD &lt;chr&gt;,
## #   Dat_Est &lt;chr&gt;, Commnts &lt;chr&gt;, SHAPE_L &lt;dbl&gt;, SHAPE_A &lt;dbl&gt;, FetClss &lt;chr&gt;,
## #   geometry &lt;MULTIPOLYGON [m]&gt;
</code></pre>
<pre><code class="language-r">regional.parcels.sf &lt;- read_sf('/Users/matthewwilliamson/Downloads/session14/Parcel_Polygons.shp')

regional.parcels.sf
</code></pre>
<pre><code>## Simple feature collection with 79360 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XYZ
## Bounding box:  xmin: -124.5124 ymin: 28.82222 xmax: -81.65863 ymax: 49.00015
## z_range:       zmin: 0 zmax: 0
## Geodetic CRS:  NAD83
## # A tibble: 79,360 × 5
##    OBJECTID_1 MTRSA_LG    Shape_Leng Shape_Area                         geometry
##         &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;               &lt;MULTIPOLYGON [°]&gt;
##  1          1 AR050020N0…     0.0317  0.0000626 Z (((-92.66263 34.76826 0, -92.…
##  2          2 AR050020S0…     0.0325  0.0000651 Z (((-93.26224 34.55195 0, -93.…
##  3          3 AR050020S0…     0.0321  0.0000639 Z (((-93.29927 34.53098 0, -93.…
##  4          4 AR050030N0…     0.0308  0.0000580 Z (((-93.66021 34.93445 0, -93.…
##  5          5 AR050030S0…     0.0324  0.0000652 Z (((-93.27249 34.44986 0, -93.…
##  6          6 AR050050N0…     0.0164  0.0000166 Z (((-94.33553 35.10705 0, -94.…
##  7          7 AR050050N0…     0.0163  0.0000164 Z (((-94.33586 35.0962 0, -94.3…
##  8          8 AR050050N0…     0.0235  0.0000328 Z (((-94.33575 35.0998 0, -94.3…
##  9          9 AR050060S0…     0.0324  0.0000651 Z (((-93.33463 34.21174 0, -93.…
## 10         10 AR050060S0…     0.0323  0.0000643 Z (((-93.768 34.2144 0, -93.767…
## # … with 79,350 more rows
</code></pre>
<h1 id="check-the-geometries-understand-the-data">Check the geometries, understand the data</h1>
<p>By now you know that before we get too far down the road, we want to check the geometries and projections of our spatial data. Let&rsquo;s do that here. We can use the <code>all()</code> function to check to see if all of the geometries are valid (i.e., <code>st_is_valid()</code> returns all <code>TRUE</code>).</p>
<pre><code class="language-r">all(st_is_valid(regional.pas.sf))
</code></pre>
<pre><code>## [1] FALSE
</code></pre>
<pre><code class="language-r">all(st_is_valid(regional.parcels.sf))
</code></pre>
<pre><code>## st_as_s2(): dropping Z and/or M coordinate
</code></pre>
<pre><code>## [1] FALSE
</code></pre>
<p>Unfortunately, they aren&rsquo;t all valid so we&rsquo;ll need to fix that here.</p>
<pre><code class="language-r">regional.pas.valid &lt;- st_make_valid(regional.pas.sf)
all(st_is_valid(regional.pas.valid)) #fixed it!
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<pre><code class="language-r">regional.parcels.valid &lt;- st_make_valid(regional.parcels.sf)
all(st_is_valid(regional.parcels.valid)) #fixed it!
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<p>Now that we&rsquo;ve gotten the geometries cleaned up, we need to make sure the two datasets align.</p>
<pre><code class="language-r">st_crs(regional.parcels.valid) == st_crs(regional.pas.valid) #Of course they dont
</code></pre>
<pre><code>## [1] FALSE
</code></pre>
<pre><code class="language-r">parcels.project &lt;- regional.parcels.valid %&gt;% 
  st_transform(., crs = st_crs(regional.pas.valid))

st_crs(parcels.project) == st_crs(regional.pas.valid) #fixed it!
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<h1 id="where-are-we-going">Where are we going?</h1>
<p>We&rsquo;d like to explore how visitation to a number of NPS units contrasts with the amount of money the US paid to purchase the land those units sit on. This means we&rsquo;ll need a dataset that contains: a) the total number of visits to each unit in 2020, b) the number of parcels that were sold within the present-day boundaries of those units, and c) the sum of the value paid for those units.</p>
<h1 id="subset-the-data-to-suit-our-questions">Subset the data to suit our questions</h1>
<p>I&rsquo;m going to focus on Idaho for this example, so I&rsquo;ll subset the data for that here.</p>
<pre><code class="language-r">id.parcels.csv &lt;- parcels.csv %&gt;% 
  filter(., Loc_State == &quot;ID&quot;)

id.park.visits &lt;- nps.visits.csv %&gt;% 
  filter(., State == &quot;ID&quot;)

id.pas.sf &lt;- regional.pas.valid %&gt;% 
  filter(., Stat_Nm == &quot;ID&quot;)
</code></pre>
<h1 id="joining-with-keypairs">Joining with keypairs</h1>
<p>You&rsquo;ll notice that the the LGU parcels dataset does not have many attributes and none that will let us use <code>filter</code> to reduce the dataset. That&rsquo;s because the bulk of the tabular data is stored in the <code>parcels.csv</code> file. We&rsquo;ll have to join them before we can subset them based on an attribute. Remember, that the <code>_join</code> commands return objects with the <code>class</code> of the first argument.</p>
<pre><code class="language-r">join1 &lt;- left_join(id.parcels.csv, parcels.project, by = &quot;MTRSA_LG&quot;)
class(join1)
</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;
</code></pre>
<pre><code class="language-r">join2 &lt;- left_join(parcels.project, id.parcels.csv, by = &quot;MTRSA_LG&quot;)
class(join2)
</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
</code></pre>
<p>Given this, there are two ways we might approach joining and subsetting the data.</p>
<pre><code class="language-r">id.parcels.sf &lt;- left_join(parcels.project, id.parcels.csv, by = &quot;MTRSA_LG&quot;) %&gt;% 
  filter(., Loc_State == &quot;ID&quot;)
class(id.parcels.sf)
</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
</code></pre>
<pre><code class="language-r">nrow(id.parcels.sf)
</code></pre>
<pre><code>## [1] 336
</code></pre>
<pre><code class="language-r">id.parcels.sf2 &lt;- inner_join(parcels.project, id.parcels.csv, by = &quot;MTRSA_LG&quot;)
class(id.parcels.sf2)
</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
</code></pre>
<pre><code class="language-r">nrow(id.parcels.sf2)
</code></pre>
<pre><code>## [1] 336
</code></pre>
<p>Okay, now all we need to do is get the visit data attached to the NPS. But before we can do that, we need to summarize the monthly visits into a total for the year.</p>
<pre><code class="language-r">id.park.visits.ann &lt;- id.park.visits %&gt;% 
  group_by(UnitCode) %&gt;% 
  summarise(., Total = sum(RecreationVisits))

id.pas.visits &lt;- id.pas.sf %&gt;% 
  inner_join(., id.park.visits.ann, by = c(&quot;Loc_Nm&quot; = &quot;UnitCode&quot;))
</code></pre>
<h1 id="joining-based-on-location">Joining based on location</h1>
<p>Now we need to figure out how many parcels are within the orignal NPS unit boundaries. We&rsquo;ll use a spatial join (<code>st_join</code>) to make that happen. Remember, that we can use any of the binary predicates (<code>?geos_binary_pred</code>) to specify how we&rsquo;d like to join the data. Here, I&rsquo;ll <code>st_is_within_distance</code> to illustrate.</p>
<pre><code class="language-r">parcels.in.pas &lt;- st_join(id.pas.visits, id.parcels.sf, join=st_is_within_distance, dist=100000)
</code></pre>
<h1 id="estimating-the-total-amount-paid">Estimating the total amount paid</h1>
<p>The result of selecting all of the parcels with 100000m of the NPS units is a data frame with 26 features (i.e., 26 parcels met the criteria). Now we need to calculate the total value (remember that we have to fix the currency to make it numeric).</p>
<pre><code class="language-r">parcels.in.pas.sum &lt;- parcels.in.pas %&gt;% 
  group_by(Unit_Nm) %&gt;% 
  summarise(., total = sum(readr::parse_number(US_Paid_for_Parcel), na.rm=TRUE))
</code></pre>

                    </div>

                    



                    
                    <div class="article-widget">
                        
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/example/06-example/" rel="next">Combining raster and vector data</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/example/04-example/" rel="prev">Working with rasters in R</a>
  </div>
  
</div>

                    </div>
                    
                </div>

                <div class="body-footer">
                    <p>Last updated on Oct 6, 2021</p>

                    





                    



                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>HES 597: Spatial Data in R (Fall 2021)</strong><br>

                <a href="https://www.boisestate.edu" target="_blank" rel="noopener">Boise State University</a> &emsp;&emsp;
                <a href="https://www.boisestate.edu/hes/" target="_blank" rel="noopener">Human-Environment Systems</a>
            </p>

            <p>
                <a href="https://www.boisestate.edu/hes/people/matt-williamson/" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Dr. Matt Williamson</a> &emsp;&emsp;
                <a href="mailto:mattwilliamson@boisestate.edu"><i class="fas fa-envelope"></i>
                    mattwilliamson@boisestate.edu</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> T TH &emsp;&emsp;
                <i class="far fa-clock"></i> 10:30 - 11:45 
                <br><i class="fas fa-university"></i> Albertson&#39;s Library Rm201C
            </p>
        </div>

        <div class="col-md-5 credits">
            <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2021 <a href="https://www.boisestate.edu/hes/people/matt-williamson/" target="_blank" rel="noopener">Matt Williamson</a></p>
        
            <p>This site was inspired by Andrew Heiss' <a href="https://datavizs21.classes.andrewheiss.com/" target="_blank" rel="noopener">Data Visualization course</a> created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/mattwilliamson13/isdrfall21" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>

        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.99ddacf76b31e04b589f8ff7e550cbb8.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>